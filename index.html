<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - ElHaji Auto</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0f172a;
      --secondary: #3b82f6;
      --accent: #ef4444;
      --light: #f8fafc;
      --dark: #1e293b;
      --gray: #64748b;
      --success: #10b981;
      --info: #0ea5e9;
      --warning: #f59e0b;
      --card-bg: rgba(30, 41, 59, 0.7);
      --sidebar-bg: rgba(15, 23, 42, 0.95);
      --hover-bg: rgba(56, 189, 248, 0.1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    
    body {
      background: radial-gradient(circle at top right, #0f172a 0%, #1e293b 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: var(--light);
      line-height: 1.6;
    }
    
    .admin-container {
      width: 100%;
      max-width: 1400px;
      background: var(--card-bg);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .admin-header {
      background: var(--primary);
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .admin-logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .admin-logo-icon {
      background: var(--secondary);
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
    }
    
    .admin-logo-text h1 {
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    
    .admin-logo-text p {
      font-size: 0.9rem;
      color: #94a3b8;
      font-weight: 500;
    }
    
    .logout-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 10px rgba(239, 68, 68, 0.25);
    }
    
    .logout-btn:hover {
      background: #dc2626;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(239, 68, 68, 0.35);
    }
    
    .admin-main {
      display: flex;
      min-height: 700px;
    }
    
    .admin-sidebar {
      width: 260px;
      background: var(--sidebar-bg);
      padding: 30px 0;
      border-right: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .admin-nav {
      list-style: none;
    }
    
    .admin-nav li {
      margin-bottom: 5px;
    }
    
    .admin-nav a {
      display: flex;
      align-items: center;
      padding: 14px 30px;
      color: #cbd5e0;
      text-decoration: none;
      transition: all 0.3s ease;
      font-weight: 500;
      gap: 15px;
      position: relative;
      font-size: 0.95rem;
    }
    
    .admin-nav a:before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: var(--secondary);
      border-radius: 0 4px 4px 0;
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }
    
    .admin-nav a:hover,
    .admin-nav a.active {
      background: var(--hover-bg);
      color: white;
    }
    
    .admin-nav a:hover:before,
    .admin-nav a.active:before {
      transform: scaleY(1);
    }
    
    .admin-nav a i {
      width: 24px;
      text-align: center;
      font-size: 1.1rem;
    }
    
    .admin-content {
      flex: 1;
      padding: 30px;
      background: rgba(255, 255, 255, 0.03);
      overflow-y: auto;
      max-height: calc(100vh - 120px);
    }
    
    .section-title {
      font-size: 1.8rem;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--secondary);
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
    }
    
    /* Formulaire d'ajout */
    .car-form {
      background: rgba(15, 23, 42, 0.4);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 40px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .form-row {
      display: flex;
      flex-wrap: wrap;
      margin: 0 -15px;
    }
    
    .form-group {
      flex: 1 0 calc(50% - 30px);
      margin: 0 15px 25px;
    }
    
    .form-group.full-width {
      flex: 1 0 calc(100% - 30px);
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #94a3b8;
      font-size: 0.9rem;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 14px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s ease;
      color: white;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.25);
    }
    
    .form-group textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    .image-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 15px;
    }
    
    .preview-item {
      position: relative;
      width: 100px;
      height: 80px;
      border-radius: 10px;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .preview-item:hover img {
      transform: scale(1.1);
    }
    
    .remove-image {
      position: absolute;
      top: 5px;
      right: 5px;
      background: var(--accent);
      color: white;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .remove-image:hover {
      transform: scale(1.1);
      background: #dc2626;
    }
    
    .form-actions {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }
    
    .submit-btn {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 15px 35px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
    }
    
    .submit-btn:hover {
      background: #2563eb;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(59, 130, 246, 0.4);
    }
    
    .reset-btn {
      background: transparent;
      color: var(--gray);
      border: 1px solid var(--gray);
      padding: 15px 25px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .reset-btn:hover {
      color: white;
      border-color: white;
      background: rgba(255, 255, 255, 0.05);
    }
    
    /* Liste des voitures */
    .cars-list {
      margin-top: 30px;
    }
    
    .cars-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 25px;
    }
    
    .car-card {
      background: var(--card-bg);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .car-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
      border-color: rgba(59, 130, 246, 0.3);
    }
    
    .car-image {
      height: 200px;
      overflow: hidden;
      position: relative;
    }
    
    .car-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s ease;
    }
    
    .car-card:hover .car-image img {
      transform: scale(1.05);
    }
    
    .car-content {
      padding: 20px;
    }
    
    .car-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      align-items: flex-start;
    }
    
    .car-title {
      font-size: 1.3rem;
      font-weight: 700;
      flex: 1;
    }
    
    .car-price {
      color: var(--secondary);
      font-weight: 700;
      font-size: 1.2rem;
      background: rgba(59, 130, 246, 0.15);
      padding: 4px 12px;
      border-radius: 20px;
    }
    
    .car-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 15px;
      font-size: 0.9rem;
      color: #94a3b8;
    }
    
    .car-details div {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .car-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .action-btn {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .edit-btn {
      background: rgba(59, 130, 246, 0.15);
      color: var(--secondary);
    }
    
    .edit-btn:hover {
      background: var(--secondary);
      color: white;
    }
    
    .delete-btn {
      background: rgba(239, 68, 68, 0.15);
      color: var(--accent);
    }
    
    .delete-btn:hover {
      background: var(--accent);
      color: white;
    }
    
    /* Styles pour le tableau des clients */
    .clients-list {
      margin-top: 30px;
      overflow-x: auto;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 5px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    #clientsTable {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: transparent;
      border-radius: 16px;
      overflow: hidden;
    }
    
    #clientsTable th {
      background: rgba(59, 130, 246, 0.2);
      padding: 16px 20px;
      text-align: left;
      font-weight: 600;
      color: #e2e8f0;
      font-size: 0.95rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    #clientsTable td {
      padding: 14px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      font-size: 0.95rem;
    }
    
    #clientsTable tr:last-child td {
      border-bottom: none;
    }
    
    #clientsTable tr:hover {
      background: rgba(59, 130, 246, 0.05);
    }
    
    .client-actions {
      display: flex;
      gap: 8px;
    }
    
    .client-btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 500;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }
    
    .view-btn {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
    }
    
    .view-btn:hover {
      background: var(--success);
      color: white;
    }
    
    .delete-btn {
      background: rgba(239, 68, 68, 0.15);
      color: var(--accent);
    }
    
    .delete-btn:hover {
      background: var(--accent);
      color: white;
    }
    
    /* Miniatures photos */
    .mini-photos {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }
    
    .mini-thumb {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.1);
      cursor: pointer;
      transition: transform 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .mini-thumb:hover {
      transform: scale(1.8);
      z-index: 10;
      position: relative;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    
    .more-photos {
      background: rgba(59, 130, 246, 0.6);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    .no-photos {
      color: #94a3b8;
      font-size: 0.9rem;
    }
    
    /* Modal demande client */
    .request-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    
    .request-modal.active {
      display: flex;
    }
    
    .request-modal .modal-content {
      background: #1e293b;
      border-radius: 16px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 30px;
      position: relative;
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .request-modal .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .request-modal .modal-title {
      font-size: 1.5rem;
      color: var(--secondary);
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
    }
    
    .request-modal .modal-close {
      font-size: 1.8rem;
      cursor: pointer;
      color: #cbd5e0;
      background: none;
      border: none;
      transition: all 0.3s ease;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    
    .request-modal .modal-close:hover {
      color: var(--accent);
      background: rgba(239, 68, 68, 0.1);
    }
    
    .request-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin: 20px 0;
    }
    
    .detail-row {
      display: flex;
      flex-direction: column;
      background: rgba(15, 23, 42, 0.4);
      padding: 18px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .detail-row.full-width {
      grid-column: 1 / -1;
    }
    
    .detail-label {
      font-weight: 600;
      color: var(--secondary);
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
    
.detail-value {
  font-size: 1rem;
  color: white;
  font-weight: 500;
  word-wrap: break-word;
  word-break: break-word;
  overflow-wrap: break-word;
  white-space: pre-wrap;
}
    
    .request-photos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 25px;
    }
    
    .request-photos img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      cursor: pointer;
      transition: transform 0.3s ease;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    
    .request-photos img:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    
    .photo-title {
      position: absolute;
      bottom: 5px;
      left: 5px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
    }
    
    /* Login page */
    .login-container {
      max-width: 450px;
      width: 100%;
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .login-header {
      background: var(--primary);
      padding: 35px 30px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .login-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .login-logo-icon {
      background: var(--secondary);
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      box-shadow: 0 6px 15px rgba(59, 130, 246, 0.3);
    }
    
    .login-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-top: 10px;
    }
    
    .login-form {
      padding: 40px 30px;
    }
    
    .form-group-login {
      margin-bottom: 25px;
    }
    
    .form-group-login label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #cbd5e0;
    }
    
    .form-group-login input {
      width: 100%;
      padding: 15px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 10px;
      font-size: 1rem;
      color: white;
      transition: all 0.3s ease;
    }
    
    .form-group-login input:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.25);
    }
    
    .login-btn {
      width: 100%;
      padding: 16px;
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
      box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
    }
    
    .login-btn:hover {
      background: #2563eb;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(59, 130, 246, 0.4);
    }
    
    .notification {
      padding: 16px;
      margin: 20px 0;
      border-radius: 10px;
      text-align: center;
      display: none;
      font-weight: 500;
      border: 1px solid transparent;
    }
    
    .success {
      background: rgba(16, 185, 129, 0.15);
      border-color: rgba(16, 185, 129, 0.3);
      color: var(--success);
    }
    
    .error {
      background: rgba(239, 68, 68, 0.15);
      border-color: rgba(239, 68, 68, 0.3);
      color: var(--accent);
    }
    
    /* Styles améliorés pour les messages de contact */
    .contact-message {
      background: rgba(15, 23, 42, 0.4);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid var(--info);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .contact-message.unread {
      border-left: 4px solid var(--warning);
      background: rgba(245, 158, 11, 0.1);
    }
    
    .contact-message.archived {
      border-left: 4px solid var(--gray);
      opacity: 0.8;
    }
    
    .message-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .message-meta {
      display: flex;
      flex-direction: column;
    }
    
    .message-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--secondary);
      margin-bottom: 5px;
    }
    
    .message-date {
      font-size: 0.9rem;
      color: #94a3b8;
    }
    
    .message-contact {
      display: flex;
      gap: 15px;
      font-size: 0.95rem;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    
    .message-contact span {
      display: flex;
      align-items: center;
      gap: 5px;
      background: rgba(30, 41, 59, 0.6);
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    
    .message-body {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .message-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .message-status {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .status-new {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }
    
    .status-read {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }
    
    .status-archived {
      background: rgba(100, 116, 139, 0.2);
      color: var(--gray);
    }
    
.message-content {
  line-height: 1.6;
  color: #e2e8f0;
  word-wrap: break-word;
  word-break: break-word;
  overflow-wrap: break-word;

  max-width: 100%;
  white-space: normal;
  overflow: hidden;
}
    
    /* Responsive */
    @media (max-width: 1200px) {
      .admin-container {
        max-width: 100%;
      }
    }
    
    @media (max-width: 992px) {
      .admin-main {
        flex-direction: column;
      }
      
      .admin-sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }
      
      .admin-nav {
        display: flex;
        flex-wrap: wrap;
        padding: 0 10px;
      }
      
      .admin-nav li {
        flex: 1;
        min-width: 150px;
      }
    }
    
    @media (max-width: 768px) {
      .form-group {
        flex: 1 0 calc(100% - 30px);
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .submit-btn, .reset-btn {
        width: 100%;
        justify-content: center;
      }
      
      .request-details {
        grid-template-columns: 1fr;
      }
      
      .client-actions {
        flex-direction: column;
      }
      
      .admin-header {
        flex-direction: column;
        text-align: center;
        gap: 20px;
      }
      
      .admin-logo {
        justify-content: center;
      }
      
      .logout-btn {
        width: 100%;
      }
    }
    .filter-options {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.filter-btn {
  padding: 10px 20px;
  border-radius: 25px;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(255,255,255,0.05);
  color: #cbd5e0;
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-btn:hover {
  background: var(--secondary);
  color: white;
  transform: translateY(-1px);
}

.filter-btn.active {
  background: var(--secondary);
  color: white;
  border-color: var(--secondary);
  box-shadow: 0 4px 12px rgba(59,130,246,0.3);
}

    @media (max-width: 576px) {
      .cars-grid {
        grid-template-columns: 1fr;
      }
      
      .message-contact {
        flex-direction: column;
        gap: 8px;
      }
      
      .message-contact span {
        width: 100%;
      }
      
      .admin-content {
        padding: 20px 15px;
      }
      
      .car-form {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Page de connexion -->
  <div id="loginPage" class="login-container">
    <div class="login-header">
      <div class="login-logo">
        <div class="login-logo-icon">
          <i class="fas fa-lock"></i>
        </div>
        <h2>Espace Admin</h2>
      </div>
      <p class="login-title">Connexion à l'administration</p>
    </div>
    
    <div class="login-form">
      <div class="notification error" id="loginError">
        <i class="fas fa-exclamation-circle"></i> Identifiants incorrects. Veuillez réessayer.
      </div>
      
      <div class="form-group-login">
        <label for="username">Email</label>
        <input type="text" id="username" placeholder="Entrez votre email" required>
      </div>
      
      <div class="form-group-login">
        <label for="password">Mot de passe</label>
        <input type="password" id="password" placeholder="Entrez votre mot de passe" required>
      </div>
      
      <button class="login-btn" id="loginBtn">
        <i class="fas fa-sign-in-alt"></i> Se connecter
      </button>
    </div>
  </div>
  
  <!-- Page d'administration (cachée par défaut) -->
  <div id="adminPage" class="admin-container" style="display: none;">
    <header class="admin-header">
      <div class="admin-logo">
        <div class="admin-logo-icon">
          <i class="fas fa-car"></i>
        </div>
        <div class="admin-logo-text">
          <h1>ElHaji Auto</h1>
          <p>Administration</p>
        </div>
      </div>
      <button class="logout-btn" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i> Déconnexion
      </button>
    </header>
    
    <div class="admin-main">
      <aside class="admin-sidebar">
        <ul class="admin-nav">
          <li><a href="#" class="active" data-section="gestion"><i class="fas fa-car"></i> Gestion des Voitures</a></li>
          <li><a href="#" data-section="ajout"><i class="fas fa-plus-circle"></i> Ajouter une Voiture</a></li>
          <li><a href="#" data-section="clients"><i class="fas fa-users"></i> Demandes Clients</a></li>
          <li><a href="#" data-section="contact"><i class="fas fa-envelope"></i> Messages Contact</a></li>
          <li><a href="#" data-section="parametres"><i class="fas fa-cog"></i> Paramètres</a></li>
        </ul>
      </aside>
      
      <main class="admin-content">
        <!-- Section de gestion des voitures -->
        <section id="gestionSection">
          <h2 class="section-title"><i class="fas fa-list"></i> Liste des Voitures</h2>
          
          <div class="notification success" id="successNotification">
            <i class="fas fa-check-circle"></i> Opération effectuée avec succès !
          </div>
          
          <div class="cars-list">
            <div class="cars-grid" id="carsGrid">
              <!-- Les cartes de voitures seront injectées ici par JavaScript -->
            </div>
          </div>
        </section>
        
        <!-- Section d'ajout de voiture -->
        <section id="ajoutSection" style="display: none;">
          <h2 class="section-title"><i class="fas fa-plus-circle"></i> Ajouter une Voiture</h2>
          
          <div class="notification error" id="formError">
            <i class="fas fa-exclamation-circle"></i> Veuillez remplir tous les champs obligatoires.
          </div>
          
          <form class="car-form" id="carForm">
            <div class="form-row">
              <div class="form-group">
                <label for="carName">Nom du modèle *</label>
                <input type="text" id="carName" placeholder="Ex: Volkswagen Golf 7 GTI" required>
              </div>
              
              <div class="form-group">
                <label for="carPrice">Prix *</label>
                <input type="text" id="carPrice" placeholder="Ex: 100 000 DH" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="carYear">Année *</label>
                <input type="number" id="carYear" min="1980" max="2025" placeholder="Ex: 2018" required>
              </div>
              
              <div class="form-group">
                <label for="carMileage">Kilométrage *</label>
                <input type="text" id="carMileage" placeholder="Ex: 75 000 km" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="carFuel">Carburant *</label>
                <select id="carFuel" required>
                  <option value="">Sélectionnez</option>
                  <option value="essence">Essence</option>
                  <option value="diesel">Diesel</option>
                  <option value="hybride">Hybride</option>
                  <option value="electrique">Électrique</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="carTransmission">Transmission *</label>
                <select id="carTransmission" required>
                  <option value="">Sélectionnez</option>
                  <option value="manuelle">Manuelle</option>
                  <option value="automatique">Automatique</option>
                </select>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="carPower">Puissance *</label>
                <input type="text" id="carPower" placeholder="Ex: 140 ch" required>
              </div>
              
              <div class="form-group">
                <label for="carColor">Couleur *</label>
                <input type="text" id="carColor" placeholder="Ex: Gris métallisé" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group full-width">
                <label for="carDescription">Description *</label>
                <textarea id="carDescription" placeholder="Décrivez la voiture en détail..." required></textarea>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group full-width">
                <label for="carImages">Images (URLs séparées par des virgules) *</label>
                <textarea id="carImages" placeholder="https://image1.jpg, https://image2.jpg" required></textarea>
                <small>Entrez les URLs des images séparées par des virgules</small>
                
                <div class="image-preview" id="imagePreview">
                  <!-- Prévisualisation des images -->
                </div>
              </div>
            </div>
            
            <input type="hidden" id="carId">
            
            <div class="form-actions">
              <button type="submit" class="submit-btn" id="saveCarBtn">
                <i class="fas fa-save"></i> Enregistrer
              </button>
              <button type="reset" class="reset-btn" id="resetBtn">
                <i class="fas fa-times"></i> Annuler
              </button>
            </div>
          </form>
        </section>
        
        <!-- Section des demandes clients -->
        <section id="clientsSection" style="display: none;">
          <h2 class="section-title"><i class="fas fa-users"></i> Demandes des Clients</h2>
          
          <div class="notification success" id="clientsSuccessNotification">
            <i class="fas fa-check-circle"></i> Opération effectuée avec succès !
          </div>
          
          <div class="clients-list">
            <table id="clientsTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Nom</th>
                  <th>Téléphone</th>
                  <th>Marque/Modèle</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Les demandes seront injectées ici par JavaScript -->
              </tbody>
            </table>
          </div>
        </section>
        
        <!-- Section des messages de contact (AMÉLIORÉE) -->
        <section id="contactSection" style="display: none;">
          <h2 class="section-title"><i class="fas fa-envelope"></i> Messages des Clients</h2>
          
          <div class="notification success" id="contactSuccessNotification">
            <i class="fas fa-check-circle"></i> Opération effectuée avec succès !
          </div>
          
<div class="filter-options">
  <button class="filter-btn active" data-filter="all">
    <i class="fas fa-inbox"></i> Tous
  </button>
  <button class="filter-btn" data-filter="unread">
    <i class="fas fa-envelope-open-text"></i> Non lus
  </button>
  <button class="filter-btn" data-filter="archived">
    <i class="fas fa-archive"></i> Archivés
  </button>
</div>
          
          <div class="messages-list" id="messagesList">
            <!-- Les messages seront injectés ici par JavaScript -->
          </div>
        </section>
        
        <!-- Section des paramètres -->
        <section id="parametresSection" style="display: none;">
          <h2 class="section-title"><i class="fas fa-cog"></i> Paramètres de l'Admin</h2>
          
          <div class="car-form">
            <div class="form-row">
              <div class="form-group">
                <label>Email actuel</label>
                <input type="text" id="currentEmail" value="" disabled>
              </div>
              
              <div class="form-group">
                <label for="newPassword">Nouveau mot de passe</label>
                <input type="password" id="newPassword" placeholder="Entrez un nouveau mot de passe">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group full-width">
                <label for="confirmPassword">Confirmer le nouveau mot de passe</label>
                <input type="password" id="confirmPassword" placeholder="Confirmez le nouveau mot de passe">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="button" class="submit-btn" id="updatePasswordBtn">
                <i class="fas fa-key"></i> Mettre à jour le mot de passe
              </button>
            </div>
          </div>
          
          <div class="car-form" style="margin-top: 40px;">
            <h3 style="color: #cbd5e0; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
              <i class="fas fa-database"></i> Gestion des Données
            </h3>
            
            <div class="form-actions">
              <button type="button" class="submit-btn" id="exportDataBtn" style="background: var(--success);">
                <i class="fas fa-file-export"></i> Exporter les données
              </button>
              <button type="button" class="reset-btn" id="importDataBtn">
                <i class="fas fa-file-import"></i> Importer des données
              </button>
              <button type="button" class="reset-btn" id="resetDataBtn" style="color: var(--accent); border-color: var(--accent);">
                <i class="fas fa-trash-alt"></i> Réinitialiser les données
              </button>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Modal pour afficher les détails d'une demande client -->
  <div class="request-modal" id="requestModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-file-alt"></i> Détails de la demande</h3>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      
      <div class="request-details" id="requestDetails">
        <!-- Les détails seront injectés ici par JavaScript -->
      </div>
      
      <h4 style="margin-top: 30px; color: var(--secondary); display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-images"></i> Photos du véhicule
      </h4>
      
      <div class="request-photos" id="requestPhotos">
        <!-- Les photos seront injectées ici par JavaScript -->
      </div>
    </div>
  </div>

  <!-- Ajout des SDK Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC0YUGE6hRG9sck7rXcqjaB3he1nRGgbbU",
      authDomain: "elhaji-auto.firebaseapp.com",
      projectId: "elhaji-auto",
      storageBucket: "elhaji-auto.appspot.com",
      messagingSenderId: "596529784342",
      appId: "1:596529784342:web:dfa01b1e33287ce36db737"
    };

    // Initialisation Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Références aux collections
    const carsCollection = db.collection("cars");
    const sellRequestsCollection = db.collection("sellRequests");
    const contactMessagesCollection = db.collection("contactMessages");

    // Identification
    const loginPage = document.getElementById('loginPage');
    const adminPage = document.getElementById('adminPage');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginError = document.getElementById('loginError');
    
    // Navigation
    const navLinks = document.querySelectorAll('.admin-nav a');
    const gestionSection = document.getElementById('gestionSection');
    const ajoutSection = document.getElementById('ajoutSection');
    const clientsSection = document.getElementById('clientsSection');
    const contactSection = document.getElementById('contactSection');
    const parametresSection = document.getElementById('parametresSection');
    
    // Formulaire
    const carForm = document.getElementById('carForm');
    const saveCarBtn = document.getElementById('saveCarBtn');
    const resetBtn = document.getElementById('resetBtn');
    const formError = document.getElementById('formError');
    const successNotification = document.getElementById('successNotification');
    const clientsSuccessNotification = document.getElementById('clientsSuccessNotification');
    const contactSuccessNotification = document.getElementById('contactSuccessNotification');
    const imagePreview = document.getElementById('imagePreview');
    const carImagesInput = document.getElementById('carImages');
    const currentEmail = document.getElementById('currentEmail');
    
    // Liste des voitures
    const carsGrid = document.getElementById('carsGrid');
    
    // Modal demande client
    const requestModal = document.getElementById('requestModal');
    const modalClose = document.getElementById('modalClose');
    const requestDetails = document.getElementById('requestDetails');
    const requestPhotos = document.getElementById('requestPhotos');
    
    // Authentification
    loginBtn.addEventListener('click', () => {
      const email = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          loginPage.style.display = 'none';
          adminPage.style.display = 'block';
          currentEmail.value = email;
          loadCars();
        })
        .catch((error) => {
          loginError.style.display = 'block';
          loginError.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${error.message}`;
        });
    });
    
    // Déconnexion
    logoutBtn.addEventListener('click', () => {
      auth.signOut().then(() => {
        adminPage.style.display = 'none';
        loginPage.style.display = 'block';
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
      });
    });
    
    // Navigation admin
    navLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const section = this.getAttribute('data-section');
        
        // Mettre à jour la navigation
        navLinks.forEach(l => l.classList.remove('active'));
        this.classList.add('active');
        
        // Afficher la bonne section
        gestionSection.style.display = 'none';
        ajoutSection.style.display = 'none';
        clientsSection.style.display = 'none';
        contactSection.style.display = 'none';
        parametresSection.style.display = 'none';
        
        if(section === 'gestion') {
          gestionSection.style.display = 'block';
          loadCars();
        } else if(section === 'ajout') {
          ajoutSection.style.display = 'block';
          resetForm();
        } else if(section === 'clients') {
          clientsSection.style.display = 'block';
          loadSellRequests();
        } else if(section === 'contact') {
          contactSection.style.display = 'block';
          loadContactMessages();
        } else if(section === 'parametres') {
          parametresSection.style.display = 'block';
        }
      });
    });
    
    // Fermer le modal
    modalClose.addEventListener('click', () => {
      requestModal.classList.remove('active');
    });
    
    // Prévisualisation des images
    carImagesInput.addEventListener('input', function() {
      const urls = this.value.split(',').map(url => url.trim()).filter(url => url);
      imagePreview.innerHTML = '';
      
      urls.forEach(url => {
        if(url) {
          const previewItem = document.createElement('div');
          previewItem.className = 'preview-item';
          previewItem.innerHTML = `
            <img src="${url}" alt="Preview">
            <div class="remove-image" data-url="${url}">&times;</div>
          `;
          imagePreview.appendChild(previewItem);
        }
      });
      
      // Gestion de la suppression d'image dans la prévisualisation
      document.querySelectorAll('.remove-image').forEach(btn => {
        btn.addEventListener('click', function() {
          const urlToRemove = this.getAttribute('data-url');
          const urls = carImagesInput.value.split(',').map(url => url.trim()).filter(url => url && url !== urlToRemove);
          carImagesInput.value = urls.join(', ');
          this.parentElement.remove();
        });
      });
    });
    
    // Sauvegarder une voiture
    carForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Validation
      if(!validateForm()) {
        formError.style.display = 'block';
        return;
      }
      
      formError.style.display = 'none';
      
      const carId = document.getElementById('carId').value;
      const carData = {
        name: document.getElementById('carName').value,
        year: document.getElementById('carYear').value,
        mileage: document.getElementById('carMileage').value,
        price: document.getElementById('carPrice').value,
        fuel: document.getElementById('carFuel').value,
        transmission: document.getElementById('carTransmission').value,
        power: document.getElementById('carPower').value,
        color: document.getElementById('carColor').value,
        description: document.getElementById('carDescription').value,
        images: document.getElementById('carImages').value.split(',').map(url => url.trim()).filter(url => url),
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      try {
        if(carId) {
          // Mettre à jour une voiture existante
          await carsCollection.doc(carId).update(carData);
        } else {
          // Ajouter une nouvelle voiture
          await carsCollection.add(carData);
        }
        
        // Afficher la notification de succès
        successNotification.style.display = 'block';
        successNotification.innerHTML = `
          <i class="fas fa-check-circle"></i> 
          Voiture ${carId ? 'modifiée' : 'ajoutée'} avec succès !
        `;
        
        // Cacher la notification après 3 secondes
        setTimeout(() => {
          successNotification.style.display = 'none';
        }, 3000);
        
        // Revenir à la liste et recharger
        gestionSection.style.display = 'block';
        ajoutSection.style.display = 'none';
        navLinks[0].classList.add('active');
        navLinks[1].classList.remove('active');
        
        loadCars();
      } catch (error) {
        formError.style.display = 'block';
        formError.innerHTML = `<i class="fas fa-exclamation-circle"></i> Erreur: ${error.message}`;
      }
    });
    
    // Réinitialiser le formulaire
    resetBtn.addEventListener('click', resetForm);
    
    // Validation du formulaire
    function validateForm() {
      const requiredFields = [
        'carName', 'carPrice', 'carYear', 'carMileage', 
        'carFuel', 'carTransmission', 'carPower', 
        'carColor', 'carDescription', 'carImages'
      ];
      
      for(const fieldId of requiredFields) {
        const field = document.getElementById(fieldId);
        if(!field.value.trim()) {
          field.focus();
          return false;
        }
      }
      
      return true;
    }
    
    // Réinitialiser le formulaire
    function resetForm() {
      carForm.reset();
      document.getElementById('carId').value = '';
      imagePreview.innerHTML = '';
      formError.style.display = 'none';
      saveCarBtn.innerHTML = '<i class="fas fa-save"></i> Enregistrer';
    }
    
    // Charger les voitures depuis Firestore
    async function loadCars() {
      try {
        const snapshot = await carsCollection.orderBy("createdAt", "desc").get();
        const cars = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        renderCars(cars);
      } catch (error) {
        console.error("Erreur lors du chargement des voitures:", error);
      }
    }
    
    // Afficher les voitures dans la grille
    function renderCars(cars) {
      carsGrid.innerHTML = '';
      
      if(cars.length === 0) {
        carsGrid.innerHTML = `
          <div class="no-cars" style="grid-column: 1/-1; text-align: center; padding: 40px; color: #a0aec0;">
            <i class="fas fa-car" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
            <h3>Aucune voiture enregistrée</h3>
            <p>Commencez par ajouter une voiture en utilisant le formulaire d'ajout.</p>
          </div>
        `;
        return;
      }
      
      cars.forEach(car => {
        const carCard = document.createElement('div');
        carCard.className = 'car-card';
        carCard.innerHTML = `
          <div class="car-image">
            <img src="${car.images[0] || 'https://via.placeholder.com/300x180?text=Image+Manquante'}" alt="${car.name}">
          </div>
          <div class="car-content">
            <div class="car-header">
              <h3 class="car-title">${car.name}</h3>
              <div class="car-price">${car.price}</div>
            </div>
            <div class="car-details">
              <div><i class="fas fa-calendar"></i> ${car.year}</div>
              <div><i class="fas fa-tachometer-alt"></i> ${car.mileage}</div>
              <div><i class="fas fa-gas-pump"></i> ${car.fuel}</div>
              <div><i class="fas fa-cog"></i> ${car.transmission}</div>
            </div>
            <div class="car-actions">
              <button class="action-btn edit-btn" data-id="${car.id}">
                <i class="fas fa-edit"></i> Modifier
              </button>
              <button class="action-btn delete-btn" data-id="${car.id}">
                <i class="fas fa-trash-alt"></i> Supprimer
              </button>
            </div>
          </div>
        `;
        carsGrid.appendChild(carCard);
      });
      
      // Ajouter les événements pour modifier et supprimer
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const carId = this.getAttribute('data-id');
          editCar(carId);
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const carId = this.getAttribute('data-id');
          deleteCar(carId);
        });
      });
    }
    
    // Modifier une voiture
    async function editCar(carId) {
      try {
        const doc = await carsCollection.doc(carId).get();
        if (!doc.exists) return;
        
        const car = doc.data();
        
        // Remplir le formulaire
        document.getElementById('carId').value = carId;
        document.getElementById('carName').value = car.name;
        document.getElementById('carYear').value = car.year;
        document.getElementById('carMileage').value = car.mileage;
        document.getElementById('carPrice').value = car.price;
        document.getElementById('carFuel').value = car.fuel;
        document.getElementById('carTransmission').value = car.transmission;
        document.getElementById('carPower').value = car.power;
        document.getElementById('carColor').value = car.color;
        document.getElementById('carDescription').value = car.description;
        document.getElementById('carImages').value = car.images.join(', ');
        
        // Mettre à jour la prévisualisation
        const event = new Event('input', { bubbles: true });
        document.getElementById('carImages').dispatchEvent(event);
        
        // Changer le texte du bouton
        saveCarBtn.innerHTML = '<i class="fas fa-save"></i> Mettre à jour';
        
        // Naviguer vers le formulaire
        ajoutSection.style.display = 'block';
        gestionSection.style.display = 'none';
        navLinks[1].classList.add('active');
        navLinks[0].classList.remove('active');
      } catch (error) {
        console.error("Erreur lors de la modification de la voiture:", error);
      }
    }
    
    // Supprimer une voiture
    async function deleteCar(carId) {
      if(confirm('Êtes-vous sûr de vouloir supprimer cette voiture ? Cette action est irréversible.')) {
        try {
          await carsCollection.doc(carId).delete();
          loadCars();
          
          // Afficher la notification de succès
          successNotification.style.display = 'block';
          successNotification.innerHTML = `
            <i class="fas fa-check-circle"></i> 
            Voiture supprimée avec succès !
          `;
          
          // Cacher la notification après 3 secondes
          setTimeout(() => {
            successNotification.style.display = 'none';
          }, 3000);
        } catch (error) {
          console.error("Erreur lors de la suppression de la voiture:", error);
        }
      }
    }
    
    // Charger les demandes de vente des clients
    async function loadSellRequests() {
      try {
        const snapshot = await sellRequestsCollection.orderBy("timestamp", "desc").get();
        const requests = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        renderSellRequests(requests);
      } catch (error) {
        console.error("Erreur lors du chargement des demandes:", error);
      }
    }
    
    // Afficher les demandes dans le tableau
    function renderSellRequests(requests) {
      const tableBody = document.querySelector('#clientsTable tbody');
      tableBody.innerHTML = '';
      
      if (requests.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 30px; color: #a0aec0;">
              <i class="fas fa-file-alt" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
              Aucune demande de vente pour le moment
            </td>
          </tr>
        `;
        return;
      }
      
      requests.forEach(request => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${formatDate(request.timestamp || request.date)}</td>
          <td>${request.name}</td>
          <td>${request.phone}</td>
          <td>${request.brand} ${request.model}</td>
          <td>
            <div class="client-actions">
              <button class="client-btn view-btn" data-id="${request.id}">
                <i class="fas fa-eye"></i> Voir
              </button>
              <button class="client-btn delete-btn" data-id="${request.id}">
                <i class="fas fa-trash-alt"></i> Supprimer
              </button>
            </div>
          </td>
        `;
        tableBody.appendChild(row);
      });
      
      // Ajouter les événements pour les boutons
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          viewRequest(requestId);
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const requestId = this.getAttribute('data-id');
          deleteRequest(requestId);
        });
      });
    }
    
    // Formater la date
    function formatDate(dateString) {
      if (!dateString) return "Date inconnue";
      
      let date;
      if (dateString instanceof firebase.firestore.Timestamp) {
        date = dateString.toDate();
      } else if (typeof dateString === 'string') {
        date = new Date(dateString);
      } else {
        return "Date inconnue";
      }
      
      return date.toLocaleDateString('fr-FR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    // Voir les détails d'une demande
    async function viewRequest(requestId) {
      try {
        const doc = await sellRequestsCollection.doc(requestId).get();
        if (!doc.exists) return;
        
        const request = doc.data();
        
        // Remplir les détails dans le modal
        requestDetails.innerHTML = `
          <div class="detail-row">
            <span class="detail-label">Date de la demande</span>
            <span class="detail-value">${formatDate(request.date)}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Nom complet</span>
            <span class="detail-value">${request.name}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Téléphone</span>
            <span class="detail-value">${request.phone}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Email</span>
            <span class="detail-value">${request.email || 'Non fourni'}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Marque</span>
            <span class="detail-value">${request.brand}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Modèle</span>
            <span class="detail-value">${request.model}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Année</span>
            <span class="detail-value">${request.year}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Kilométrage</span>
            <span class="detail-value">${request.mileage} km</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Carburant</span>
            <span class="detail-value">${request.fuel}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Transmission</span>
            <span class="detail-value">${request.transmission}</span>
          </div>
          
          <div class="detail-row full-width">
            <span class="detail-label">État du véhicule</span>
            <span class="detail-value">${request.condition || 'Non spécifié'}</span>
          </div>
        `;
        
        // Afficher les photos
        requestPhotos.innerHTML = '';
        if (request.images && request.images.length > 0) {
          request.images.forEach((image, index) => {
            const imgContainer = document.createElement('div');
            imgContainer.style.position = 'relative';
            imgContainer.style.overflow = 'hidden';
            imgContainer.style.borderRadius = '6px';
            
            const img = document.createElement('img');
            img.src = image;
            img.alt = `Photo du véhicule ${index + 1}`;
            img.style.cursor = 'pointer';
            img.style.width = '100%';
            img.style.height = '150px';
            img.style.objectFit = 'cover';
            
            const imgTitle = document.createElement('div');
            imgTitle.textContent = `Photo ${index + 1}`;
            imgTitle.className = 'photo-title';
            
            imgContainer.appendChild(img);
            imgContainer.appendChild(imgTitle);
            requestPhotos.appendChild(imgContainer);
          });
        } else {
          requestPhotos.innerHTML = `
            <div class="no-photos" style="grid-column: 1/-1; text-align: center; padding: 20px; color: #a0aec0;">
              <i class="fas fa-camera" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
              Aucune photo fournie
            </div>
          `;
        }
        
        // Afficher le modal
        requestModal.classList.add('active');
      } catch (error) {
        console.error("Erreur lors de l'affichage de la demande:", error);
      }
    }
    
    // Supprimer une demande
    async function deleteRequest(requestId) {
      if (confirm('Êtes-vous sûr de vouloir supprimer cette demande ? Cette action est irréversible.')) {
        try {
          await sellRequestsCollection.doc(requestId).delete();
          loadSellRequests();
          
          // Afficher la notification de succès
          clientsSuccessNotification.style.display = 'block';
          clientsSuccessNotification.innerHTML = `
            <i class="fas fa-check-circle"></i> 
            Demande supprimée avec succès !
          `;
          
          // Cacher la notification après 3 secondes
          setTimeout(() => {
            clientsSuccessNotification.style.display = 'none';
          }, 3000);
        } catch (error) {
          console.error("Erreur lors de la suppression de la demande:", error);
        }
      }
    }
    
    // Charger les messages de contact depuis Firestore
    async function loadContactMessages() {
      try {
        const snapshot = await contactMessagesCollection.orderBy("date", "desc").get();
        const messages = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        renderContactMessages(messages);
      } catch (error) {
        console.error("Erreur lors du chargement des messages:", error);
      }
    }
    
    // Afficher les messages dans une liste améliorée
    function renderContactMessages(messages) {
      const messagesList = document.getElementById('messagesList');
      messagesList.innerHTML = '';
      
      if (messages.length === 0) {
        messagesList.innerHTML = `
          <div style="text-align: center; padding: 40px; color: #a0aec0;">
            <i class="fas fa-envelope" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
            <h3>Aucun message pour le moment</h3>
            <p>Aucun message n'a été reçu.</p>
          </div>
        `;
        return;
      }
      
      messages.forEach(message => {
        const messageEl = document.createElement('div');
        messageEl.className = 'contact-message';
        if (!message.read) messageEl.classList.add('unread');
        if (message.status === 'archived') messageEl.classList.add('archived');
        
        messageEl.innerHTML = `
          <div class="message-header">
            <div class="message-meta">
              <div class="message-title">${getSubjectLabel(message.subject)}</div>
              <div class="message-date">${formatDate(message.date)}</div>
            </div>
            <div class="message-status status-${message.status || 'new'}">
              ${message.status === 'read' ? 'Lu' : 
                message.status === 'archived' ? 'Archivé' : 'Nouveau'}
            </div>
          </div>
          
          <div class="message-contact">
            <span><i class="fas fa-user"></i> ${message.name}</span>
            <span><i class="fas fa-envelope"></i> ${message.email}</span>
            <span><i class="fas fa-phone"></i> ${message.phone || 'Non fourni'}</span>
          </div>
          
          <div class="message-body">
            <div class="message-content">${message.message}</div>
            <div class="message-actions">
              <button class="client-btn view-btn" data-id="${message.id}">
                <i class="fas fa-eye"></i> Voir détails
              </button>
              <button class="client-btn" style="background: rgba(113, 128, 150, 0.2); color: var(--gray);" 
                      data-id="${message.id}" data-action="archive">
                <i class="fas fa-archive"></i> ${message.status === 'archived' ? 'Désarchiver' : 'Archiver'}
              </button>
              <button class="client-btn delete-btn" data-id="${message.id}">
                <i class="fas fa-trash-alt"></i> Supprimer
              </button>
            </div>
          </div>
        `;
        
        messagesList.appendChild(messageEl);
      });
      
      // Ajouter les événements pour les boutons
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const messageId = this.getAttribute('data-id');
          viewContactMessage(messageId);
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const messageId = this.getAttribute('data-id');
          deleteContactMessage(messageId);
        });
      });
      
      document.querySelectorAll('[data-action="archive"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const messageId = this.getAttribute('data-id');
          toggleArchiveMessage(messageId);
        });
      });
    }
    
    // Fonction pour obtenir le libellé du sujet
    function getSubjectLabel(subject) {
      const subjects = {
        'info': 'Demande d\'information',
        'rdv': 'Demande de rendez-vous',
        'test': 'Demande d\'essai',
        'service': 'Service après-vente'
      };
      return subjects[subject] || subject;
    }
    
    // Voir les détails d'un message
    async function viewContactMessage(messageId) {
      try {
        const doc = await contactMessagesCollection.doc(messageId).get();
        if (!doc.exists) return;
        
        const message = doc.data();
        
        // Marquer comme lu
        if (!message.read) {
          await contactMessagesCollection.doc(messageId).update({
            read: true,
            status: 'read'
          });
        }
        
        // Afficher les détails dans le modal existant
        requestDetails.innerHTML = `
          <div class="detail-row">
            <span class="detail-label">Date du message</span>
            <span class="detail-value">${formatDate(message.date)}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Nom complet</span>
            <span class="detail-value">${message.name}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Email</span>
            <span class="detail-value">${message.email}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Téléphone</span>
            <span class="detail-value">${message.phone || 'Non fourni'}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Sujet</span>
            <span class="detail-value">${getSubjectLabel(message.subject)}</span>
          </div>
          
          <div class="detail-row full-width">
            <span class="detail-label">Message</span>
            <span class="detail-value">${message.message}</span>
          </div>
        `;
        
        // Cacher la section photos car non pertinente ici
        requestPhotos.innerHTML = '';
        requestPhotos.style.display = 'none';
        
        // Modifier le titre du modal
        document.querySelector('.modal-title').innerHTML = '<i class="fas fa-envelope"></i> Détails du message';
        
        // Afficher le modal
        requestModal.classList.add('active');
      } catch (error) {
        console.error("Erreur lors de l'affichage du message:", error);
      }
    }
    
    // Archiver/Désarchiver un message
    async function toggleArchiveMessage(messageId) {
      try {
        const doc = await contactMessagesCollection.doc(messageId).get();
        if (!doc.exists) return;
        
        const message = doc.data();
        const newStatus = message.status === 'archived' ? 'read' : 'archived';
        
        await contactMessagesCollection.doc(messageId).update({
          status: newStatus
        });
        
        loadContactMessages();
        
        // Afficher la notification de succès
        contactSuccessNotification.style.display = 'block';
        contactSuccessNotification.innerHTML = `
          <i class="fas fa-check-circle"></i> 
          Message ${newStatus === 'archived' ? 'archivé' : 'désarchivé'} avec succès !
        `;
        
        // Cacher la notification après 3 secondes
        setTimeout(() => {
          contactSuccessNotification.style.display = 'none';
        }, 3000);
      } catch (error) {
        console.error("Erreur lors de la modification du message:", error);
      }
    }
    
    // Supprimer un message
    async function deleteContactMessage(messageId) {
      if (confirm('Êtes-vous sûr de vouloir supprimer ce message ? Cette action est irréversible.')) {
        try {
          await contactMessagesCollection.doc(messageId).delete();
          loadContactMessages();
          
          // Afficher la notification de succès
          contactSuccessNotification.style.display = 'block';
          contactSuccessNotification.innerHTML = `
            <i class="fas fa-check-circle"></i> 
            Message supprimé avec succès !
          `;
          
          // Cacher la notification après 3 secondes
          setTimeout(() => {
            contactSuccessNotification.style.display = 'none';
          }, 3000);
        } catch (error) {
          console.error("Erreur lors de la suppression du message:", error);
        }
      }
    }
    
    // Mettre à jour le mot de passe
    document.getElementById('updatePasswordBtn').addEventListener('click', async () => {
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (newPassword !== confirmPassword) {
        alert("Les mots de passe ne correspondent pas");
        return;
      }
      
      if (newPassword.length < 6) {
        alert("Le mot de passe doit contenir au moins 6 caractères");
        return;
      }
      
      try {
        const user = auth.currentUser;
        await user.updatePassword(newPassword);
        alert("Mot de passe mis à jour avec succès !");
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmPassword').value = '';
      } catch (error) {
        alert(`Erreur: ${error.message}`);
      }
    });
    
    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
      // Vérifier si l'utilisateur est déjà connecté
      auth.onAuthStateChanged(user => {
        if (user) {
          loginPage.style.display = 'none';
          adminPage.style.display = 'block';
          currentEmail.value = user.email;
          loadCars();
        } else {
          loginPage.style.display = 'block';
          adminPage.style.display = 'none';
          document.getElementById('username').focus();
        }
      });
    });
  </script>
</body>
</html>
